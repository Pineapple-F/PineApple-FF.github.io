# 单片机——蓝桥杯备赛

蓝桥杯比赛指定单片机跟51单片机差不多，可以通过淘宝国信长天购买。

本次学习跟着[b站小蜜蜂老师的视频](https://www.bilibili.com/video/BV1Bt41187hw/?vd_source=59e4e13f0e1002ef3a96e7a6170a57aa)

使用的相关软件为 keil4 和 STC-ISP

## 相关软件使用

 keil4作用是编写代码和编译

STC-ISP的作用是将keil4得到的16进制码下载到我们的板子上

### keil4使用

1. 选一个位置存代码，新建文件夹
2. 打开keil4，顶栏选择Project，再选择第一个New Project，找到刚才建的文件夹，自己写一个项目名，然后在Atmel中找到AT89C52
3. 新建c文件，保存在刚才建的项目文件夹中
4. 在左侧项目栏中右键项目文件夹，找到add什么那个，然后把建的c文件加进去
5. 改成16进制输出
6. 写代码，编译

### STC-ISP使用

1. 点打开程序文件，打开要下载到板子上的.hex文件
2. 点下载/编程
3. 按板子上的下载按钮完成下载

------

下面我们实现各个元件的控制

## LED指示灯的控制

在蓝桥杯指定单片机上已经有了诸多外设，传感器等等，板子的内部电路固定。所以需要通过特定的电路来对电路原件做相应的控制，而不像大一的电子设计课一样需要自己连线，可以自己定每条线插在哪个口。

### LED电路

板子上共有8个我们需要控制的LED，由一个三八译码器74HC138，一个锁存器74HC573，和或非门构成，而我们就需要通过改变这几个原件的输入输出从而控制LED亮灭，那我们一一来看一看电路图。

- **三八译码器（74HC138）**

<img src="image\ca6b90b2e3077bcbd1fb46538f3fa3b.png" alt="ca6b90b2e3077bcbd1fb46538f3fa3b" style="zoom:150%;" />

​	简单的三八译码器，有三个输入控制对应的八个输出，符合二进制规律

​	注意的是，该三八译码器八路输出中只有一路是Low，其他都是High

​	P25, P26, P27连接HC138的 A, B, C输入端，分别对应二进制的第0位，第1位和第2位

​	本次控制LED我们需要让Y4为Low，所以我们要让CBA为100时，此时二进制对应为4即Y4为Low，其余输出均为High

- **锁存器（74HC573）**

  

<img src="image\e2489def9312e404eaac29046a99369.png" alt="e2489def9312e404eaac29046a99369" style="zoom:80%;" />

​	有用的只有图中Y4C输入：

​	Y4C为High，那么八个输出和八个输入保持一致（输出跟着输入随时变）

​	Y4C为Low，那么八个输出并不改变（输出不跟着输入变，还是原来的输出值）

​	那么Y4C是啥呢？如下：

<img src="image\dbc69a7aff4b84f57d8a8c082498a4c.png" alt="dbc69a7aff4b84f57d8a8c082498a4c" style="zoom:200%;" />

​	图有点糊，但没啥事

​	WR一般都是0，Y4和Y4C相反

​	所以在上面我们让CBA是100，Y4为Low，那么Y4C就是High，此时我们就可以顺利通过P0^1到8来控制八个	小灯泡了，0为亮，1为灭，即P0 = 0x00代表8个小灯泡全亮，P0 = 0xff代表8个小灯泡全灭。

至此，有关LED的电路部分介绍完毕，我们开始进行代码的编写。

### LED代码

整个51单片机编程使用的都是C语言，很好上手

- 引入头文件

  ```c++
  #include "reg52.h"
  ```

​	引入此头文件之后我们可以用特定字母代表指定引脚，比如P2^5代表电路图中的P25

- 对应引脚定义

  ```c
  sbit HC138_A = P2^5;
  sbit HC138_B = P2^6;
  sbit HC138_C = P2^7;
  ```

- 延迟函数

  ```C
  void Delay(unsigned int t){
  	while(t--);
  	while(t--);
  	while(t--);
  }
  ```

​	每个延迟函数都这么写就行

- **LED控制函数**

  ```C
  void LEDRunning(){	   
  	unsigned int i;
  	//Y4 = 0
  	HC138_C = 1;
  	HC138_B = 0;
  	HC138_A = 0;			  		
  	
      //跑马灯
  	for (i = 1; i <= 8; i++){
  		P0 = 0xff << i;
  		Delay(60000);
  	}
  	for (i = 1; i <= 8; i++){
  		P0 = ~(0xff << i);		
  		Delay(60000);	
  	}
      
      //8个LED整体闪三下
  	for(i = 0; i < 3; i++){
  		P0 = 0x00;
  		Delay(60000);
  		P0 = 0xff;
  		Delay(60000);
  	}
  }
  ```

- 主函数

  ```C
  void main(){
  	while (1){
  		LEDRunning();
  	}						   
  }
  ```

  简简单单主函数，不断循环LED控制函数

编写完代码下载到板子上，进行验证以及修改

至此，我们就可以顺利控制LED了

## 继电器和蜂鸣器

### 电路部分

![055e11268c30d61c5937a455b638d2d](image\055e11268c30d61c5937a455b638d2d.png)

如图，N_RELAY连的是继电器，N_BUZZ连的是蜂鸣器，相对应的输入分别是P04和P06，输入为High时工作。

和上面LED不同，与锁存器相连的是Y5C，所以要控制继电器和蜂鸣器，我们需要使74HC138的输出Y5为Low，其他输出为High，即CBA为101；

### 代码部分

- 代码优化

  由于本次涉及到了Y5C，我们可以写一个函数来决定HC138的输出

  ```C
  void InitHC138(unsigned char n){
  	switch(n){
  		case 4:
  			HC138_C = 1;
  			HC138_B = 0;
  			HC138_A = 0;
  		break;
  		case 5:
  			HC138_C = 1;
  			HC138_B = 0;
  			HC138_A = 1;
  		break;
  		case 6:
  			HC138_C = 1;
  			HC138_B = 1;
  			HC138_A = 0;
  		break;
  		case 7:
  			HC138_C = 1;
  			HC138_B = 1;
  			HC138_A = 1; 
  		break;
  	}
  }
  ```

  通过这个函数，我们只需一个数字便可以得到我们想要的输出从而选择控制哪部分电路

- 控制继电器和蜂鸣器

  ```C
  //继电器吸合
  	InitHC138(5);
  	P0 = 0x10;
  	Delay(60000);
  	P0 = 0x00;
  	
  //蜂鸣器叫一下
  	InitHC138(5);
  	P0 = 0x40;
  	Delay(60000);
  	P0 = 0x00;
  ```

  

